(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8456],{4527:function(e,t,a){Promise.resolve().then(a.t.bind(a,38173,23)),Promise.resolve().then(a.bind(a,52014))},52014:function(e,t,a){"use strict";var s=a(57437),r=a(95956),n=a(16463),l=a(17821),d=a(14245),i=a(38472),o=a(2265),c=a(30998),u=a(90346),m=a.n(u),h=a(79501);t.default=e=>{var t;let{product:a,halls:u}=e,{data:x,status:p}=(0,c.useSession)(),g=(0,n.useRouter)(),[v,b]=(0,o.useState)([]),[_,y]=(0,o.useState)(""),[f,j]=(0,o.useState)(""),N=u.map(e=>({value:e.id,label:"".concat(e.hall_name," (Capacity: ").concat(e.hall_capacity,")")})),w=async()=>{try{let e=await i.Z.get("/api/eventtype");b(e.data)}catch(e){r.Am.error("Event Types not found"),console.error("Error fetching event types:",e)}};(0,o.useEffect)(()=>{w()},[]),(0,o.useEffect)(()=>{var e;(null==x?void 0:null===(e=x.user)||void 0===e?void 0:e.id)&&k.setFieldValue("userId",x.user.id),(null==a?void 0:a.id)&&k.setFieldValue("productId",a.id)},[x,a]),(0,d.Ry)().shape({id:(0,d.Rx)().optional(),name:(0,d.Z_)().required("EventType name is required")});let D=new Date,S=new Date(D.setDate(D.getDate()+2)),E=(0,d.Ry)({start_date:(0,d.hT)().required("Start date is required").min(S,"Start date must be at least 3 days from today").test("is-not-in-past","Start date cannot be in the past",e=>e&&new Date(e).setHours(0,0,0,0)>=new Date().setHours(0,0,0,0)),end_date:(0,d.hT)().required("End date is required").min(new Date,"End date cannot be in the past").test("is-greater-or-equal","End date must be greater than the start date",function(e){let{start_date:t}=this.parent;return!t||null===e||new Date(e)>new Date(t)}),Hall:(0,d.IX)().min(1,"At least one hall must be selected").required("Hall selection is required"),events:(0,d.IX)().of((0,d.Ry)({id:(0,d.Z_)().required("Event ID is required")})).required("At least one event is required")}),k=(0,l.TA)({validationSchema:E,initialValues:{start_date:new Date(new Date().setDate(new Date().getDate()+3)).toISOString().split("T")[0],end_date:new Date(new Date().setDate(new Date().getDate()+4)).toISOString().split("T")[0],start_time:"",end_time:"",userId:x&&(null==x?void 0:null===(t=x.user)||void 0===t?void 0:t.id)||0,productId:(null==a?void 0:a.id)||0,events:[{id:""}],Hall:[]},onSubmit:(e,t)=>{let{resetForm:a}=t;A({...e,start_date:new Date(e.start_date),end_date:new Date(e.end_date),start_time:e.start_time?e.start_time:null,end_time:e.end_time?e.end_time:null,userId:Number(e.userId),productId:Number(e.productId)},a)},validateOnMount:!0}),{errors:I,getFieldProps:H,touched:q,isValid:C}=k;(0,o.useEffect)(()=>{},[I,C]);let A=async(e,t)=>{try{await i.Z.post("/api/bookings",{start_date:e.start_date,end_date:e.end_date,start_time:e.start_time,end_time:e.end_time,userId:e.userId,productId:e.productId,events:e.events,Hall:e.Hall},{headers:{"Content-Type":"application/json"}}),r.Am.success("Event request sent!"),t(),g.push("/")}catch(e){i.Z.isAxiosError(e)&&e.response&&409===e.response.status?r.Am.error(e.response.data.message):r.Am.error("Error creating booking")}};return(0,s.jsx)("div",{className:"relative bg-white border border-gray-200 rounded-xl shadow-sm",children:(null==x?void 0:x.user)?(0,s.jsxs)("div",{className:"p-4 sm:p-7",children:[(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("h1",{className:"block text-2xl font-bold text-gray-800",children:"Book Now"})}),(0,s.jsx)("div",{className:"mt-5",children:(0,s.jsx)("form",{className:"sticky",onSubmit:k.handleSubmit,children:(0,s.jsxs)("div",{className:"grid gap-y-4",children:[(0,s.jsx)("label",{htmlFor:"start_date",className:"block text-sm ",children:"Start Date"}),(0,s.jsx)("input",{type:"date",id:"start_date",...k.getFieldProps("start_date"),onChange:e=>{k.handleChange(e);let[t,a,s]=e.target.value.split("-").map(Number),r=new(m())(new Date(t,a-1,s));y("".concat(r.getYear(),"-").concat(r.getMonth()+1,"-").concat(r.getDate()+1))},className:"py-2 px-3 border ".concat(k.touched.start_date&&k.errors.start_date?"border-orange-500":"border-gray-200"," rounded")}),k.touched.start_date&&k.errors.start_date&&(0,s.jsx)("div",{className:"text-red-500 text-sm",children:k.errors.start_date}),_&&(0,s.jsxs)("div",{className:"mt-1 text-sm text-gray-700",children:["BS: ",_]}),(0,s.jsx)("label",{htmlFor:"end_date",className:"block text-sm ",children:"End Date"}),(0,s.jsx)("input",{type:"date",id:"end_date",...k.getFieldProps("end_date"),onChange:e=>{k.handleChange(e);let[t,a,s]=e.target.value.split("-").map(Number),r=new(m())(new Date(t,a-1,s));j("".concat(r.getYear(),"-").concat(r.getMonth()+1,"-").concat(r.getDate()+1))},className:"py-2 px-3 border ".concat(k.touched.end_date&&k.errors.end_date?"border-orange-500":"border-gray-200"," rounded")}),k.touched.end_date&&k.errors.end_date&&(0,s.jsx)("div",{className:"text-red-500 text-sm",children:k.errors.end_date}),f&&(0,s.jsxs)("div",{className:"mt-1 text-sm text-gray-700",children:["BS: ",f]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"Hall",className:"inline-block text-sm text-gray-800 mt-2.5",children:"Select Halls"}),(0,s.jsx)(h.ZP,{id:"Hall",isMulti:!0,name:"Hall",options:N,classNamePrefix:"react-select",value:N.filter(e=>k.values.Hall.includes(e.value)),onChange:e=>{let t=e?e.map(e=>e.value):[];k.setFieldValue("Hall",t)}}),k.errors.Hall&&(0,s.jsx)("div",{className:"text-red-500 text-sm",children:k.errors.Hall})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"hall",className:"inline-block text-sm text-gray-800 mt-2.5",children:"Select Event"}),(0,s.jsxs)("select",{id:"events[0].id",onChange:e=>{let t=e.target.value;k.setFieldValue("events",[{id:t}])},className:"py-2 px-3 block w-full border-gray-200 shadow-sm sm:mt-0 text-sm relative rounded-lg ring-1 ring-gray-300 focus:ring-2 focus:ring-orange-500 focus:outline-none",children:[(0,s.jsx)("option",{value:"",children:"Select an Event"}),v&&v.length>0?v.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id)):(0,s.jsx)("option",{disabled:!0,children:"No Events available"})]}),Array.isArray(I.events)?I.events.length>0&&"object"==typeof I.events[0]&&"id"in I.events[0]&&(0,s.jsx)("div",{className:"text-red-500 text-sm",children:I.events[0].id}):"string"==typeof I.events&&(0,s.jsx)("div",{className:"text-red-500 text-sm",children:I.events})]}),(0,s.jsx)("button",{type:"submit",disabled:!k.isValid,className:"w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent text-white focus:outline-none ".concat(k.isValid?"bg-orange-600 text-white":"bg-gray-300 text-gray-500"),children:"Check Availability"})]})})})]}):(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 backdrop-blur-md flex flex-col items-center justify-center rounded-xl",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-white",children:"Login to Book the Venue"}),(0,s.jsx)("p",{className:"text-sm text-white",children:"To fill out the form, please log in."}),(0,s.jsx)("button",{onClick:()=>g.push("/login"),className:"mt-4 bg-red-600 text-white py-2 px-4 rounded-lg",children:"Log in to fill the form"})]})})})}}},function(e){e.O(0,[8173,998,5956,4870,7475,8472,4209,2971,7023,1744],function(){return e(e.s=4527)}),_N_E=e.O()}]);